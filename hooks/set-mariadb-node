#!/bin/bash

set -e

#app_name=$1
#namespace=$2
#local_gear=$3

echo "$@" >> $OPENSHIFT_DATA_DIR/log

# find main node addr
echo ${@:4};
for arg in ${@:4}; do
	arg=$(echo "$arg" | tr -d "\n" | tr -d "'")
	gear=$(echo "$arg" | cut -f 1 -d '=')
	addr=$(echo "$arg" | cut -f 3 -d '=')

echo "arg=$arg gear=$gear addr=$addr"

	if fgrep -q "$addr" env/OPENSHIFT_MARIADB_NODE_GEARS
	then
		# Remove Existing Gear
		# Assumption that if the same gets published it is because the gear is being removed
		node_gears=`cat env/OPENSHIFT_MARIADB_NODE_GEARS`
		for remove_gear in ${addr} ; do
			node_gears=${node_array/ $remove_gear /}
		done
		echo -n $node_gears > env/OPENSHIFT_MARIADB_NODE_GEARS

	else
		# Append to list of gears
		echo -n "${addr} " >> env/OPENSHIFT_MARIADB_NODE_GEARS
	fi	
done

