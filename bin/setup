#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH
source "$OPENSHIFT_MARIADB_DIR/lib/mysql_context"

case "$1" in
  -v|--version)
    version="$2"
esac

# Create our data directories
mkdir -p $OPENSHIFT_MARIADB_DIR/{log,pid,socket,data,run}

# Move cnf files
mv $OPENSHIFT_MARIADB_DIR/conf/my-init.cnf.erb $OPENSHIFT_MARIADB_DIR/conf/my-init.cnf.erb.hidden
mv $OPENSHIFT_MARIADB_DIR/conf/my-cluster.cnf.erb $OPENSHIFT_MARIADB_DIR/conf/my-cluster.cnf.erb.hidden

# Touch our variables so they are owned by our user
touch $OPENSHIFT_MARIADB_DIR/env/OPENSHIFT_MARIADB_SST_GEARS
touch $OPENSHIFT_MARIADB_DIR/env/OPENSHIFT_MARIADB_NODE_GEARS
touch $OPENSHIFT_MARIADB_DIR/env/OPENSHIFT_MARIADB_GALERA_GEARS

update_configuration $version
